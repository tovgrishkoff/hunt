#!/usr/bin/env python3
"""
–£–º–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞
–° –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π ChatGPT API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–¥–∞—é—â–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤
"""

import re
import random
import asyncio
import logging
from typing import List, Dict, Optional

logger = logging.getLogger(__name__)

class SmartResponseAnalyzer:
    def __init__(self, use_chatgpt: bool = True):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
        
        Args:
            use_chatgpt: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ChatGPT API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é True)
        """
        self.use_chatgpt = use_chatgpt
        self.chatgpt_generator = None
        
        if use_chatgpt:
            try:
                from chatgpt_response_generator import ChatGPTResponseGenerator
                self.chatgpt_generator = ChatGPTResponseGenerator()
                if self.chatgpt_generator.enabled:
                    logger.info("‚úÖ ChatGPT Response Generator –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
                else:
                    logger.warning("‚ö†Ô∏è ChatGPT API –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è fallback")
            except ImportError:
                logger.warning("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å ChatGPTResponseGenerator, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback")
                self.use_chatgpt = False
        # –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ —É—Å–ª—É–≥–∏
        self.service_keywords = {
            'photo_video': [
                '—Ñ–æ—Ç–æ', '–≤–∏–¥–µ–æ', '—Å—ä—ë–º–∫–∞', '—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ', '–≤–∏–¥–µ–æ–≥—Ä–∞—Ñ', '–æ–ø–µ—Ä–∞—Ç–æ—Ä', 
                '–º–æ–Ω—Ç–∞–∂', '—Ñ–æ—Ç–æ—Å–µ—Å—Å–∏—è', '—Å–≤–∞–¥—å–±–∞', '–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤', '—Ä–µ–∫–ª–∞–º–∞'
            ],
            'real_estate': [
                '–Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å', '–∫–≤–∞—Ä—Ç–∏—Ä–∞', '–¥–æ–º', '–≤–∏–ª–ª–∞', '–ø–æ–∫—É–ø–∫–∞', 
                '–ø—Ä–æ–¥–∞–∂–∞', '—Ä–∏–µ–ª—Ç–æ—Ä', '–∞–≥–µ–Ω—Ç—Å—Ç–≤–æ', '–∂–∏–ª—å—ë'
            ],
            'beauty': [
                '–º–∞–Ω–∏–∫—é—Ä', '–ø–µ–¥–∏–∫—é—Ä', '–±—Ä–æ–≤–∏', '—Ä–µ—Å–Ω–∏—Ü—ã', '–º–∞–∫–∏—è–∂', '–∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—è', 
                '–∫—Ä–∞—Å–æ—Ç–∞', '—É—Ö–æ–¥', '–ø—Ä–æ—Ü–µ–¥—É—Ä—ã', '—Å–∞–ª–æ–Ω'
            ],
            'transport': [
                '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç', '—Ç–∞–∫—Å–∏', '–∞—Ä–µ–Ω–¥–∞', '–º–æ—Ç–æ—Ü–∏–∫–ª', '—Å–∫—É—Ç–µ—Ä', '–º–∞—à–∏–Ω–∞', 
                '–ø–µ—Ä–µ–≤–æ–∑–∫–∞', '–¥–æ—Å—Ç–∞–≤–∫–∞', '—Ç—Ä–∞–Ω—Å—Ñ–µ—Ä'
            ],
            'tourism': [
                '—Ç—É—Ä', '—ç–∫—Å–∫—É—Ä—Å–∏—è', '–≥–∏–¥', '–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ', '–æ—Ç–¥—ã—Ö', '–æ—Ç–µ–ª—å', 
                '—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è', '–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏'
            ]
        }
        
        # –û—Ç–≤–µ—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —É—Å–ª—É–≥–∏
        self.responses = {
            'photo_video': [
                "–ü—Ä–∏–≤–µ—Ç! –°–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ! –ö—Å—Ç–∞—Ç–∏, –∞ –∫–∞–∫ —Ç—ã –æ–±—ã—á–Ω–æ –Ω–∞—Ö–æ–¥–∏—à—å –∫–ª–∏–µ–Ω—Ç–æ–≤? –Ø –Ω–µ–¥–∞–≤–Ω–æ –Ω–∞—á–∞–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å @Lead_Hunbot - –æ—á–µ–Ω—å –ø–æ–º–æ–≥–∞–µ—Ç –≤ –ø–æ–∏—Å–∫–µ –∑–∞–∫–∞–∑—á–∏–∫–æ–≤. –ú–æ–∂–µ—Ç, —Ç–µ–±–µ —Ç–æ–∂–µ –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è?",
                "–û—Ç–ª–∏—á–Ω–æ! –ê –≥–¥–µ —Ç—ã –∏—â–µ—à—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ —Å–≤–æ–∏ —É—Å–ª—É–≥–∏? –Ø –∏—Å–ø–æ–ª—å–∑—É—é @Lead_Hunbot - –∑–∞ –º–µ—Å—è—Ü –ø–æ–ª—É—á–∏–ª –±–æ–ª—å—à–µ –∑–∞–∫–∞–∑–æ–≤, —á–µ–º —Ä–∞–Ω—å—à–µ –∑–∞ –ø–æ–ª–≥–æ–¥–∞. –†–µ–∫–æ–º–µ–Ω–¥—É—é –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å!",
                "–ö—Ä—É—Ç–æ! –ê –∫–∞–∫ —Ç—ã –ø—Ä–∏–≤–ª–µ–∫–∞–µ—à—å –∫–ª–∏–µ–Ω—Ç–æ–≤? –Ø –Ω–µ–¥–∞–≤–Ω–æ –æ—Ç–∫—Ä—ã–ª –¥–ª—è —Å–µ–±—è @Lead_Hunbot - —Ä–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ó–∞ 2 –Ω–µ–¥–µ–ª–∏ –ø–æ–ª—É—á–∏–ª 8 –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤. –°—Ç–æ–∏—Ç –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å!"
            ],
            'real_estate': [
                "–ü—Ä–∏–≤–µ—Ç! –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ! –ê –∫–∞–∫ —Ç—ã –æ–±—ã—á–Ω–æ –Ω–∞—Ö–æ–¥–∏—à—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å? –Ø –∏—Å–ø–æ–ª—å–∑—É—é @Lead_Hunbot - –æ—á–µ–Ω—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π. –ú–æ–∂–µ—Ç, —Ç–µ–±–µ —Ç–æ–∂–µ –ø–æ–º–æ–∂–µ—Ç?",
                "–û—Ç–ª–∏—á–Ω–æ! –ê –≥–¥–µ —Ç—ã –∏—â–µ—à—å –∫–ª–∏–µ–Ω—Ç–æ–≤? –Ø –Ω–µ–¥–∞–≤–Ω–æ –Ω–∞—á–∞–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å @Lead_Hunbot - –∑–∞ –º–µ—Å—è—Ü —É–¥–≤–æ–∏–ª –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–¥–µ–ª–æ–∫. –†–µ–∫–æ–º–µ–Ω–¥—É—é –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å!",
                "–ö—Ä—É—Ç–æ! –ê –∫–∞–∫ —Ç—ã –ø—Ä–∏–≤–ª–µ–∫–∞–µ—à—å –∫–ª–∏–µ–Ω—Ç–æ–≤? –Ø –∏—Å–ø–æ–ª—å–∑—É—é @Lead_Hunbot - –∑–∞ 3 –Ω–µ–¥–µ–ª–∏ –ø–æ–ª—É—á–∏–ª –±–æ–ª—å—à–µ –∫–ª–∏–µ–Ω—Ç–æ–≤, —á–µ–º –∑–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ 2 –º–µ—Å—è—Ü–∞. –°—Ç–æ–∏—Ç –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å!"
            ],
            'beauty': [
                "–ü—Ä–∏–≤–µ—Ç! –°–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ! –ê –∫–∞–∫ —Ç—ã –æ–±—ã—á–Ω–æ –Ω–∞—Ö–æ–¥–∏—à—å –∫–ª–∏–µ–Ω—Ç–æ–≤? –Ø –∏—Å–ø–æ–ª—å–∑—É—é @Lead_Hunbot - –æ—á–µ–Ω—å –ø–æ–º–æ–≥–∞–µ—Ç –≤ –ø–æ–∏—Å–∫–µ –∫–ª–∏–µ–Ω—Ç–æ–≤. –ó–∞ –Ω–µ–¥–µ–ª—é –ø–æ–ª—É—á–∏–ª 5 –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–∫. –†–µ–∫–æ–º–µ–Ω–¥—É—é –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å!",
                "–û—Ç–ª–∏—á–Ω–æ! –ê –≥–¥–µ —Ç—ã –∏—â–µ—à—å –∫–ª–∏–µ–Ω—Ç–æ–≤? –Ø –Ω–µ–¥–∞–≤–Ω–æ –æ—Ç–∫—Ä—ã–ª –¥–ª—è —Å–µ–±—è @Lead_Hunbot - —Ä–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ó–∞ –º–µ—Å—è—Ü –ø–æ–ª—É—á–∏–ª –±–æ–ª—å—à–µ –∫–ª–∏–µ–Ω—Ç–æ–≤, —á–µ–º —Ä–∞–Ω—å—à–µ –∑–∞ –ø–æ–ª–≥–æ–¥–∞. –°—Ç–æ–∏—Ç –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å!",
                "–ö—Ä—É—Ç–æ! –ê –∫–∞–∫ —Ç—ã –ø—Ä–∏–≤–ª–µ–∫–∞–µ—à—å –∫–ª–∏–µ–Ω—Ç–æ–≤? –Ø –∏—Å–ø–æ–ª—å–∑—É—é @Lead_Hunbot - –∑–∞ 2 –Ω–µ–¥–µ–ª–∏ –ø–æ–ª—É—á–∏–ª 7 –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–∫. –ú–æ–∂–µ—Ç, —Ç–µ–±–µ —Ç–æ–∂–µ –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è?"
            ],
            'transport': [
                "–ü—Ä–∏–≤–µ—Ç! –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ! –ê –∫–∞–∫ —Ç—ã –æ–±—ã—á–Ω–æ –Ω–∞—Ö–æ–¥–∏—à—å –∫–ª–∏–µ–Ω—Ç–æ–≤? –Ø –∏—Å–ø–æ–ª—å–∑—É—é @Lead_Hunbot - –æ—á–µ–Ω—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤. –ó–∞ –º–µ—Å—è—Ü –ø–æ–ª—É—á–∏–ª –±–æ–ª—å—à–µ –∑–∞–∫–∞–∑–æ–≤, —á–µ–º —Ä–∞–Ω—å—à–µ –∑–∞ 2 –º–µ—Å—è—Ü–∞. –†–µ–∫–æ–º–µ–Ω–¥—É—é –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å!",
                "–û—Ç–ª–∏—á–Ω–æ! –ê –≥–¥–µ —Ç—ã –∏—â–µ—à—å –∫–ª–∏–µ–Ω—Ç–æ–≤? –Ø –Ω–µ–¥–∞–≤–Ω–æ –Ω–∞—á–∞–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å @Lead_Hunbot - —Ä–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ó–∞ 3 –Ω–µ–¥–µ–ª–∏ –ø–æ–ª—É—á–∏–ª 12 –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤. –°—Ç–æ–∏—Ç –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å!",
                "–ö—Ä—É—Ç–æ! –ê –∫–∞–∫ —Ç—ã –ø—Ä–∏–≤–ª–µ–∫–∞–µ—à—å –∫–ª–∏–µ–Ω—Ç–æ–≤? –Ø –∏—Å–ø–æ–ª—å–∑—É—é @Lead_Hunbot - –∑–∞ –Ω–µ–¥–µ–ª—é –ø–æ–ª—É—á–∏–ª 6 –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤. –ú–æ–∂–µ—Ç, —Ç–µ–±–µ —Ç–æ–∂–µ –ø–æ–º–æ–∂–µ—Ç?"
            ],
            'tourism': [
                "–ü—Ä–∏–≤–µ—Ç! –°–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ! –ê –∫–∞–∫ —Ç—ã –æ–±—ã—á–Ω–æ –Ω–∞—Ö–æ–¥–∏—à—å –∫–ª–∏–µ–Ω—Ç–æ–≤? –Ø –∏—Å–ø–æ–ª—å–∑—É—é @Lead_Hunbot - –æ—á–µ–Ω—å –ø–æ–º–æ–≥–∞–µ—Ç –≤ –ø–æ–∏—Å–∫–µ —Ç—É—Ä–∏—Å—Ç–æ–≤. –ó–∞ –º–µ—Å—è—Ü –ø–æ–ª—É—á–∏–ª –±–æ–ª—å—à–µ –∑–∞–∫–∞–∑–æ–≤, —á–µ–º —Ä–∞–Ω—å—à–µ –∑–∞ –ø–æ–ª–≥–æ–¥–∞. –†–µ–∫–æ–º–µ–Ω–¥—É—é –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å!",
                "–û—Ç–ª–∏—á–Ω–æ! –ê –≥–¥–µ —Ç—ã –∏—â–µ—à—å –∫–ª–∏–µ–Ω—Ç–æ–≤? –Ø –Ω–µ–¥–∞–≤–Ω–æ –æ—Ç–∫—Ä—ã–ª –¥–ª—è —Å–µ–±—è @Lead_Hunbot - —Ä–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ó–∞ 2 –Ω–µ–¥–µ–ª–∏ –ø–æ–ª—É—á–∏–ª 10 –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤. –°—Ç–æ–∏—Ç –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å!",
                "–ö—Ä—É—Ç–æ! –ê –∫–∞–∫ —Ç—ã –ø—Ä–∏–≤–ª–µ–∫–∞–µ—à—å –∫–ª–∏–µ–Ω—Ç–æ–≤? –Ø –∏—Å–ø–æ–ª—å–∑—É—é @Lead_Hunbot - –∑–∞ –Ω–µ–¥–µ–ª—é –ø–æ–ª—É—á–∏–ª 4 –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞. –ú–æ–∂–µ—Ç, —Ç–µ–±–µ —Ç–æ–∂–µ –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è?"
            ],
            'default': [
                "–ü—Ä–∏–≤–µ—Ç! –°–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ! –ö—Å—Ç–∞—Ç–∏, –∞ –∫–∞–∫ —Ç—ã –æ–±—ã—á–Ω–æ –Ω–∞—Ö–æ–¥–∏—à—å –∫–ª–∏–µ–Ω—Ç–æ–≤? –Ø –∏—Å–ø–æ–ª—å–∑—É—é @Lead_Hunbot - –æ—á–µ–Ω—å –ø–æ–º–æ–≥–∞–µ—Ç –≤ –ø–æ–∏—Å–∫–µ –∑–∞–∫–∞–∑—á–∏–∫–æ–≤. –ó–∞ –º–µ—Å—è—Ü –ø–æ–ª—É—á–∏–ª –±–æ–ª—å—à–µ –∫–ª–∏–µ–Ω—Ç–æ–≤, —á–µ–º —Ä–∞–Ω—å—à–µ –∑–∞ –ø–æ–ª–≥–æ–¥–∞. –†–µ–∫–æ–º–µ–Ω–¥—É—é –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å!",
                "–û—Ç–ª–∏—á–Ω–æ! –ê –≥–¥–µ —Ç—ã –∏—â–µ—à—å –∫–ª–∏–µ–Ω—Ç–æ–≤? –Ø –Ω–µ–¥–∞–≤–Ω–æ –æ—Ç–∫—Ä—ã–ª –¥–ª—è —Å–µ–±—è @Lead_Hunbot - —Ä–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ó–∞ 2 –Ω–µ–¥–µ–ª–∏ –ø–æ–ª—É—á–∏–ª –±–æ–ª—å—à–µ –∑–∞–∫–∞–∑–æ–≤, —á–µ–º –∑–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ 3 –º–µ—Å—è—Ü–∞. –°—Ç–æ–∏—Ç –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å!",
                "–ö—Ä—É—Ç–æ! –ê –∫–∞–∫ —Ç—ã –ø—Ä–∏–≤–ª–µ–∫–∞–µ—à—å –∫–ª–∏–µ–Ω—Ç–æ–≤? –Ø –∏—Å–ø–æ–ª—å–∑—É—é @Lead_Hunbot - –∑–∞ –Ω–µ–¥–µ–ª—é –ø–æ–ª—É—á–∏–ª 5 –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤. –ú–æ–∂–µ—Ç, —Ç–µ–±–µ —Ç–æ–∂–µ –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è?"
            ]
        }
    
    async def analyze_message_async(self, message: str) -> str:
        """
        –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏–π –æ—Ç–≤–µ—Ç (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å ChatGPT)
        """
        message_lower = message.lower()
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —É—Å–ª—É–≥–∏ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
        service_type = self._detect_service_type(message_lower)
        
        # –ü—ã—Ç–∞–µ–º—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ChatGPT –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–¥–∞—é—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞
        if self.use_chatgpt and self.chatgpt_generator and self.chatgpt_generator.enabled:
            try:
                logger.info(f"ü§ñ [CHATGPT] –ü—ã—Ç–∞—é—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ ChatGPT API...")
                chatgpt_response = await self.chatgpt_generator.generate_selling_response(
                    message, 
                    service_type
                )
                if chatgpt_response:
                    logger.info(f"‚úÖ [CHATGPT] –£—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ ChatGPT –¥–ª—è —Ç–∏–ø–∞ '{service_type}'")
                    logger.info(f"üìù [CHATGPT] –û—Ç–≤–µ—Ç: {chatgpt_response[:150]}...")
                    return chatgpt_response
                else:
                    logger.warning(f"‚ö†Ô∏è [CHATGPT] ChatGPT –≤–µ—Ä–Ω—É–ª None, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback")
            except Exception as e:
                logger.warning(f"‚ö†Ô∏è [CHATGPT] –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ChatGPT –æ—Ç–≤–µ—Ç–∞: {e}, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback")
        
        # Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä—ã–µ —à–∞–±–ª–æ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
        responses = self.responses.get(service_type, self.responses['default'])
        logger.info(f"üìã –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω fallback –æ—Ç–≤–µ—Ç –¥–ª—è —Ç–∏–ø–∞ '{service_type}'")
        return random.choice(responses)
    
    def analyze_message(self, message: str) -> str:
        """
        –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏–π –æ—Ç–≤–µ—Ç (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        –î–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å–æ —Å—Ç–∞—Ä—ã–º –∫–æ–¥–æ–º
        """
        message_lower = message.lower()
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —É—Å–ª—É–≥–∏ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
        service_type = self._detect_service_type(message_lower)
        
        # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ —É—Å–ª—É–≥–∏
        responses = self.responses.get(service_type, self.responses['default'])
        return random.choice(responses)
    
    def _detect_service_type(self, message: str) -> str:
        """
        –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø —É—Å–ª—É–≥–∏ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏
        """
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –ø–µ—Ä–≤—ã–º–∏
        specific_keywords = {
            'beauty': ['–º–∞–Ω–∏–∫—é—Ä', '–ø–µ–¥–∏–∫—é—Ä', '–±—Ä–æ–≤–∏', '—Ä–µ—Å–Ω–∏—Ü—ã', '–º–∞–∫–∏—è–∂', '–∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—è'],
            'photo_video': ['—Ñ–æ—Ç–æ', '–≤–∏–¥–µ–æ', '—Å—ä—ë–º–∫–∞', '—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ', '–≤–∏–¥–µ–æ–≥—Ä–∞—Ñ', '–æ–ø–µ—Ä–∞—Ç–æ—Ä'],
            'transport': ['—Å–∫—É—Ç–µ—Ä', '–º–æ—Ç–æ—Ü–∏–∫–ª', '—Ç–∞–∫—Å–∏', '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç', '–ø–µ—Ä–µ–≤–æ–∑–∫–∞'],
            'tourism': ['—ç–∫—Å–∫—É—Ä—Å–∏—è', '–≥–∏–¥', '—Ç—É—Ä', '–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ', '–æ—Ç–¥—ã—Ö'],
            'real_estate': ['–Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å', '–∫–≤–∞—Ä—Ç–∏—Ä–∞', '–¥–æ–º', '–≤–∏–ª–ª–∞', '—Ä–∏–µ–ª—Ç–æ—Ä']
        }
        
        # –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
        for service_type, keywords in specific_keywords.items():
            for keyword in keywords:
                if keyword in message:
                    return service_type
        
        # –ó–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—â–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
        for service_type, keywords in self.service_keywords.items():
            for keyword in keywords:
                if keyword in message:
                    return service_type
        return 'default'
    
    def get_response_for_service(self, service_type: str) -> str:
        """
        –ü–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø–∞ —É—Å–ª—É–≥–∏
        """
        responses = self.responses.get(service_type, self.responses['default'])
        return random.choice(responses)

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
if __name__ == "__main__":
    analyzer = SmartResponseAnalyzer()
    
    # –¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    test_messages = [
        "–ü—Ä–∏–≤–µ—Ç! –Ø —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ, –º–æ–≥—É —Å–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ—Å–µ—Å—Å–∏—é –Ω–∞ –ë–∞–ª–∏. –¶–µ–Ω—ã –æ—Ç 100$",
        "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ü—Ä–µ–¥–ª–∞–≥–∞—é –∞—Ä–µ–Ω–¥—É –≤–∏–ª–ª—ã –Ω–∞ –ë–∞–ª–∏. 3 —Å–ø–∞–ª—å–Ω–∏, –±–∞—Å—Å–µ–π–Ω",
        "–ü—Ä–∏–≤–µ—Ç! –î–µ–ª–∞—é –º–∞–Ω–∏–∫—é—Ä –∏ –ø–µ–¥–∏–∫—é—Ä. –í—ã–µ–∑–¥ –Ω–∞ –¥–æ–º. –¶–µ–Ω—ã –æ—Ç 50$",
        "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ü—Ä–µ–¥–ª–∞–≥–∞—é –∞—Ä–µ–Ω–¥—É —Å–∫—É—Ç–µ—Ä–∞ –Ω–∞ –ë–∞–ª–∏. 10$ –≤ –¥–µ–Ω—å",
        "–ü—Ä–∏–≤–µ—Ç! –û—Ä–≥–∞–Ω–∏–∑—É—é —ç–∫—Å–∫—É—Ä—Å–∏–∏ –ø–æ –ë–∞–ª–∏. –ì–∏–¥ —Å –æ–ø—ã—Ç–æ–º 5 –ª–µ—Ç"
    ]
    
    print("üß† –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–º–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ –æ—Ç–≤–µ—Ç–æ–≤:")
    print("=" * 60)
    
    for i, message in enumerate(test_messages, 1):
        response = analyzer.analyze_message(message)
        print(f"\n{i}. –í—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: {message}")
        print(f"   –û—Ç–≤–µ—Ç: {response}")
        print("-" * 60)
