import asyncio
import os
from ai_classifier import AIClassifier

# API –∫–ª—é—á –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏
if not os.getenv("OPENAI_API_KEY"):
    raise RuntimeError("OPENAI_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏")

async def test_ai_classifier():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç AI –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö"""
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä
    classifier = AIClassifier(os.environ["OPENAI_API_KEY"])
    
    # –¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    test_messages = [
        # –°–ø–∞–º —Å –Ω–∞—Ä–∫–æ—Ç–∏–∫–∞–º–∏
        "–ü–æ–Ω–∏–∫–∞(–≤–¥–æ–≤–∞ –≥–æ–ª–æ–≤—ã) –Ω–µ–¥–æ—Ä–æ–≥–æ —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π, –±–æ–ª–µ–µ –¥–≤—É—Ö –ª–µ—Ç —Ä–∞–±–æ—Ç—ã –æ—Ç–∑—ã–≤—ã –∏ –≥–∞—Ä–∞–Ω—Ç–∏—è —Å—å–µ–º–∞ –ø–∏—à–∏—Ç–µüòâ–µ—â—ë –µ—Å—Ç—å –ø–µ—Ä–≤—ã–π(–±–æ–ª–∏–≤–∏—è) –∏ –¥—Ä—É–≥–æ–µ",
        
        # –°–ø–∞–º —Å –±–∞–Ω–∫–æ–≤—Å–∫–∏–º–∏ –∫–∞—Ä—Ç–∞–º–∏
        "üî§üî§üî§üî§ –ü—Ä–æ–¥–∞–º –Ω–µ–¥–æ—Ä–æ–≥–æ –õ–ö Sberbank üá∑üá∫ + –æ—Ç–ø—Ä–∞–≤–ª—é –ø–ª–∞—Å—Ç–∏–∫ –∫–∞—Ä—Ç—É –≤ –≤–∞—à –≥–æ—Ä–æ–¥",
        
        # –õ–µ–≥–∏—Ç–∏–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç—É—Ä–∏–∑–º–µ
        "–ü—Ä–∏–≤–µ—Ç! –ò—â—É –≥–∏–¥–∞ –¥–ª—è —ç–∫—Å–∫—É—Ä—Å–∏–∏ –ø–æ –ë–∞–ª–∏ –Ω–∞ 3 –¥–Ω—è. –ë—é–¥–∂–µ—Ç 500-700 –¥–æ–ª–ª–∞—Ä–æ–≤. –ö—Ç–æ –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å?",
        
        # –õ–µ–≥–∏—Ç–∏–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
        "–°–¥–∞–º 2-–∫–æ–º–Ω–∞—Ç–Ω—É—é –∫–≤–∞—Ä—Ç–∏—Ä—É –≤ —Ü–µ–Ω—Ç—Ä–µ –£–±—É–¥–∞, 800$ –≤ –º–µ—Å—è—Ü, –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ. –í—Å–µ –≤–∫–ª—é—á–µ–Ω–æ.",
        
        # –õ–µ–≥–∏—Ç–∏–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–µ
        "–§–æ—Ç–æ–≥—Ä–∞—Ñ –Ω–∞ –ë–∞–ª–∏! –°–≤–∞–¥–µ–±–Ω–∞—è —Å—ä–µ–º–∫–∞, —Å–µ–º–µ–π–Ω—ã–µ —Ñ–æ—Ç–æ—Å–µ—Å—Å–∏–∏, –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è Instagram. –¶–µ–Ω—ã –æ—Ç 100$",
        
        # –°–ø–∞–º —Å –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ–º
        "–ë—ã—Å—Ç—Ä—ã–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫! –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞! –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏! –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Ö–æ–¥ 500% –≤ –º–µ—Å—è—Ü!",
    ]
    
    print("ü§ñ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞...")
    print("=" * 60)
    
    for i, message in enumerate(test_messages, 1):
        print(f"\nüìù –¢–µ—Å—Ç {i}: {message[:100]}...")
        
        try:
            result = await classifier.classify_message(message)
            
            print(f"‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:")
            print(f"   –°–ø–∞–º: {result['is_spam']}")
            print(f"   –ù–∏—à–∏: {result['niches']}")
            print(f"   –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {result['confidence']}%")
            print(f"   –ü—Ä–∏—á–∏–Ω–∞: {result['reason']}")
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        
        print("-" * 40)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
    print("\nüîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è...")
    test_message = "–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è"
    
    # –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å
    result1 = await classifier.classify_message(test_message)
    print(f"–ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å: {result1['confidence']}%")
    
    # –í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–∑ –∫—ç—à–∞)
    result2 = await classifier.classify_message(test_message)
    print(f"–í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å: {result2['confidence']}%")
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞
    cache_stats = classifier.get_cache_stats()
    print(f"\nüìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞: {cache_stats}")
    
    print("\n‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!")

if __name__ == "__main__":
    asyncio.run(test_ai_classifier()) 