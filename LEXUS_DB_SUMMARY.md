# üìã –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ: –ú–∏–≥—Ä–∞—Ü–∏—è Lexus –Ω–∞ PostgreSQL

## ‚úÖ –ß—Ç–æ —Å–æ–∑–¥–∞–Ω–æ

### 1. –ú–æ–¥–µ–ª–∏ –ë–î (`lexus_db/models.py`)
- ‚úÖ `Account` - –∞–∫–∫–∞—É–Ω—Ç—ã —Å –ª–∏–º–∏—Ç–∞–º–∏ –∏ FloodWait
- ‚úÖ `Target` - –≥—Ä—É–ø–ø—ã —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –∞–∫–∫–∞—É–Ω—Ç–∞–º, warm-up, –ª–∏–º–∏—Ç–∞–º–∏
- ‚úÖ `PostHistory` - –∏—Å—Ç–æ—Ä–∏—è –ø–æ—Å—Ç–æ–≤

### 2. –°–µ—Å—Å–∏–∏ (`lexus_db/session.py`)
- ‚úÖ Async SQLAlchemy —Å–µ—Å—Å–∏–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Docker —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (Docker/localhost)

### 3. –ú–µ–Ω–µ–¥–∂–µ—Ä –ë–î (`lexus_db/db_manager.py`)
- ‚úÖ `assign_group()` - –ø—Ä–∏–≤—è–∑–∫–∞ –≥—Ä—É–ø–ø—ã –∫ –∞–∫–∫–∞—É–Ω—Ç—É
- ‚úÖ `get_groups_ready_for_posting()` - –≤—ã–±–æ—Ä–∫–∞ –≥—Ä—É–ø–ø —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- ‚úÖ `record_post()` - –∑–∞–ø–∏—Å—å –ø–æ—Å—Ç–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤
- ‚úÖ `set_account_flood_wait()` / `clear_account_flood_wait()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ FloodWait
- ‚úÖ `reset_daily_counters_if_needed()` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–æ–≤

### 4. –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ (`lexus_db/migrate_from_files.py`)
- ‚úÖ –ß–∏—Ç–∞–µ—Ç `targets.txt`, `group_niches.json`, `accounts_config.json`
- ‚úÖ –ú–∏–≥—Ä–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ Lexus –∞–∫–∫–∞—É–Ω—Ç—ã (–∏–∑ `lexus_accounts_config.json`)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–∏–≤—è–∑–∫–∏ –≥—Ä—É–ø–ø –∫ –∞–∫–∫–∞—É–Ω—Ç–∞–º (–∏–∑ `group_account_assignments.json`)

## üîë –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **–°—Ç—Ä–æ–≥–∞—è –ø—Ä–∏–≤—è–∑–∫–∞:** `assigned_account_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `targets`
2. **Warm-up:** 24 —á–∞—Å–∞ –ø–æ—Å–ª–µ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è (`warmup_ends_at`)
3. **–õ–∏–º–∏—Ç—ã:** 2 –ø–æ—Å—Ç–∞/–¥–µ–Ω—å –≤ –≥—Ä—É–ø–ø—É, 20 –ø–æ—Å—Ç–æ–≤/–¥–µ–Ω—å —Å –∞–∫–∫–∞—É–Ω—Ç–∞
4. **–ê–≤—Ç–æ—Å–±—Ä–æ—Å:** –°—á–µ—Ç—á–∏–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –Ω–∞—á–∞–ª–µ –¥–Ω—è

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
echo "asyncpg>=0.29.0" >> requirements.txt

# 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å DATABASE_URL –≤ docker-compose.lexus.yml

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
python3 lexus_db/migrate_from_files.py

# 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–æ–¥–µ
from lexus_db.session import AsyncSessionLocal
from lexus_db.db_manager import DbManager

async with AsyncSessionLocal() as session:
    db = DbManager(session)
    groups = await db.get_groups_ready_for_posting(niche='ukraine_cars')
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–º. `LEXUS_DB_MIGRATION_GUIDE.md` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –ø—Ä–∏–º–µ—Ä–æ–≤.
