# üì¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Marketer (–ü–æ—Å—Ç–µ—Ä–∞)

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ

–ú–æ–¥—É–ª—å **SmartPoster** –ø—É–±–ª–∏–∫—É–µ—Ç —Ä–µ–∫–ª–∞–º–Ω—ã–µ –ø–æ—Å—Ç—ã –≤ –≥—Ä—É–ø–ø—ã, –∫–æ—Ç–æ—Ä—ã–µ:
- –ò–º–µ—é—Ç —Å—Ç–∞—Ç—É—Å `joined`
- –ü—Ä–æ—à–ª–∏ warm-up –ø–µ—Ä–∏–æ–¥ (24 —á–∞—Å–∞ –ø–æ—Å–ª–µ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è)
- –ü—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∞–∫–∫–∞—É–Ω—Ç—É
- –ù–µ –ø—Ä–µ–≤—ã—Å–∏–ª–∏ –ª–∏–º–∏—Ç –ø–æ—Å—Ç–æ–≤ (2 –ø–æ—Å—Ç–∞ –≤ –¥–µ–Ω—å –Ω–∞ –≥—Ä—É–ø–ø—É, 20 –ø–æ—Å—Ç–æ–≤ –≤ –¥–µ–Ω—å –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç)

## üì¶ –§–∞–π–ª—ã

1. **`services/marketer/poster.py`** - –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å –ø–æ—Å—Ç–∏–Ω–≥–∞
2. **`config/marketing_posts.json`** - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤ (—Ç–µ–∫—Å—Ç—ã –∏ —Ñ–æ—Ç–æ)

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤

–†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `config/marketing_posts.json` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤ –∏ –ø—É—Ç–µ–π –∫ —Ñ–æ—Ç–æ:

```json
{
  "ukraine_cars": [
    {
      "text": "üöó –ü—Ä–æ–¥–∞–º Lexus IS 250...",
      "image": "/app/assets/lexus_variant_1.jpg"
    }
  ],
  "bali_rent": [
    {
      "text": "üè† Villa for rent...",
      "image": "/app/assets/villa1.jpg"
    }
  ]
}
```

**–í–∞–∂–Ω–æ:**
- –ü—É—Ç–∏ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º volumes –≤ docker-compose
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/app/assets/` –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∏–∑ `data/{PROJECT_NAME}/assets/`)
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `null` –¥–ª—è –ø–æ—Å—Ç–æ–≤ –±–µ–∑ —Ñ–æ—Ç–æ

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

```bash
# –¢–µ—Å—Ç –ø–æ—Å—Ç–∏–Ω–≥–∞ (Bali)
docker exec bali-marketer python3 /app/services/marketer/poster.py bali_rent 5

# –¢–µ—Å—Ç –ø–æ—Å—Ç–∏–Ω–≥–∞ (Ukraine)
docker exec ukraine-marketer python3 /app/services/marketer/poster.py ukraine_cars 5
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Cron

–ó–∞–¥–∞—á–∏ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `crontab.combined`:

**Bali:**
- –í 10:00 –∏ 16:00 –µ–∂–µ–¥–Ω–µ–≤–Ω–æ

**Ukraine:**
- –í 09:00 –∏ 18:00 –µ–∂–µ–¥–Ω–µ–≤–Ω–æ

–î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
```bash
./install-cron.sh
# –∏–ª–∏
crontab crontab.combined
```

## üîÑ –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

1. **–í—ã–±–æ—Ä –≥—Ä—É–ø–ø**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `DbManager.get_groups_ready_for_posting()`
   - –°—Ç–∞—Ç—É—Å: `joined`
   - Warm-up –∑–∞–≤–µ—Ä—à–µ–Ω: `warmup_ends_at < NOW()`
   - –õ–∏–º–∏—Ç—ã –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω—ã: `daily_posts_in_group < 2`, `daily_posts_count < 20`
   - –ê–∫–∫–∞—É–Ω—Ç –∞–∫—Ç–∏–≤–µ–Ω –∏ –Ω–µ –≤–æ FloodWait

2. **–ü—Ä–∏–≤—è–∑–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞**: –ë–µ—Ä–µ—Ç `assigned_account_id` –∏–∑ –≥—Ä—É–ø–ø—ã
   - –°—Ç—Ä–æ–≥–∞—è –ø—Ä–∏–≤—è–∑–∫–∞: —Ç–æ–ª—å–∫–æ —Ç–æ—Ç –∞–∫–∫–∞—É–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—Å—Ç—É–ø–∏–ª

3. **–í—ã–±–æ—Ä –ø–æ—Å—Ç–∞**: –°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä –∏–∑ `config/marketing_posts.json`

4. **–û—Ç–ø—Ä–∞–≤–∫–∞**: 
   - –° —Ñ–æ—Ç–æ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ –∏ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
   - –¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç (–µ—Å–ª–∏ —Ñ–æ—Ç–æ –Ω–µ—Ç)

5. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î**:
   - `last_post_at = NOW()`
   - –ó–∞–ø–∏—Å—å –≤ `post_history`
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ —á–µ—Ä–µ–∑ `record_post()`

## ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- **FloodWait**: –ê–∫–∫–∞—É–Ω—Ç –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `flood_wait`, –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è
- **ChatWriteForbiddenError**: –ì—Ä—É–ø–ø–∞ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `banned`
- **UserBannedInChannelError**: –ì—Ä—É–ø–ø–∞ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `banned`

## üìä –õ–æ–≥–∏

–õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –≤:
- –§–∞–π–ª: `data/{PROJECT_NAME}/logs/poster.log`
- Cron –ª–æ–≥–∏: `data/{PROJECT_NAME}/logs/poster_cron.log`

## ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π

Marketer –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ü–∏–∫–ª:

1. **Scout** ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç –≥—Ä—É–ø–ø—ã ‚Üí `status='new'`
2. **Smart Joiner** ‚Üí –≤—Å—Ç—É–ø–∞–µ—Ç ‚Üí `status='joined'`, `warmup_ends_at = NOW() + 24h`
3. **Marketer** ‚Üí —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞ ‚Üí –ø–æ—Å—Ç–∏—Ç ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç `last_post_at`
4. **Secretary** ‚Üí –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
tail -f data/bali/logs/poster.log
tail -f data/ukraine/logs/poster.log

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î
docker exec -it bali-postgres psql -U telegram_user_bali -d bali_db -c "SELECT link, status, last_post_at, warmup_ends_at FROM targets WHERE status='joined' LIMIT 10;"
```

## üìÅ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–∞—Ä—Ç–∏–Ω–æ–∫

–ü–æ–ª–æ–∂–∏—Ç–µ —Ñ–æ—Ç–æ –¥–ª—è —Ä–µ–∫–ª–∞–º—ã –≤ –ø–∞–ø–∫–∏ –∞—Å—Å–µ—Ç–æ–≤:

```bash
# –î–ª—è –ë–∞–ª–∏
cp my_villa.jpg data/bali/assets/bali_villa_1.jpg

# –î–ª—è –£–∫—Ä–∞–∏–Ω—ã
cp my_car.jpg data/ukraine/assets/lexus_variant_1.jpg
```

**–í–∞–∂–Ω–æ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É—Ç–∏ –≤ `config/marketing_posts.json` –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `/app/assets/...` (—ç—Ç–æ –ø—É—Ç—å –≤–Ω—É—Ç—Ä–∏ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞).

## üêõ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Ä—É—á–Ω—É—é, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É:

```bash
# –¢–µ—Å—Ç –ë–∞–ª–∏ (–æ—Ç–ø—Ä–∞–≤–∏—Ç 1 –ø–æ—Å—Ç)
docker exec -it bali-marketer python3 /app/services/marketer/poster.py bali_rent 1

# –¢–µ—Å—Ç –£–∫—Ä–∞–∏–Ω–∞ (–æ—Ç–ø—Ä–∞–≤–∏—Ç 1 –ø–æ—Å—Ç)
docker exec -it ukraine-marketer python3 /app/services/marketer/poster.py ukraine_cars 1
```

## ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

- **ChatWriteForbidden**: –ì—Ä—É–ø–ø–∞ –∑–∞–ø—Ä–µ—Ç–∏–ª–∞ –ø–∏—Å–∞—Ç—å (–∞–¥–º–∏–Ω—ã –∑–∞–∫—Ä—ã–ª–∏ —á–∞—Ç). –°–∫—Ä–∏–ø—Ç –ø–æ–º–µ—Ç–∏—Ç –≥—Ä—É–ø–ø—É —Å—Ç–∞—Ç—É—Å–æ–º `banned` –∏ –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç –µ–µ —Ç—Ä–æ–≥–∞—Ç—å.

- **Image not found**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –ª–µ–∂–∏—Ç –≤ –ø–∞–ø–∫–µ `data/{PROJECT_NAME}/assets/`, –∞ –≤ –∫–æ–Ω—Ñ–∏–≥–µ –ø—É—Ç—å —É–∫–∞–∑–∞–Ω –∫–∞–∫ `/app/assets/...`.

- **FloodWait**: –ê–∫–∫–∞—É–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `flood_wait` –∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è.
