# üìã –ß–ï–ö-–õ–ò–°–¢ –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê (–ü–µ—Ä–≤—ã–µ 24 —á–∞—Å–∞)

**–î–∞—Ç–∞:** 2026-01-10  
**–í—Ä–µ–º—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–ª–æ—Ç–∞ Account Manager:** 09:00 (Asia/Jakarta)

---

## üéØ 1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Account Manager (09:00 Jakarta)

### –ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö:

```bash
docker-compose logs -f account-manager | grep -E "(joined|Sleeping|FloodWait|‚úÖ|‚ùå|üìã –û–±—Ä–∞–±–æ—Ç–∞–µ–º)"
```

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
```
üìã –û–±—Ä–∞–±–æ—Ç–∞–µ–º 5 –≥—Ä—É–ø–ø –∏–∑ 144 (–ª–∏–º–∏—Ç: 5 –∑–∞ —Å–ª–æ—Ç)
[1/5] @group1
  ‚úÖ –£—Å–ø–µ—à–Ω–æ –≤—Å—Ç—É–ø–∏–ª–∏ –≤ –≥—Ä—É–ø–ø—É
  ‚è∏ –ü–∞—É–∑–∞ 7 –º–∏–Ω—É—Ç –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ–º...
[2/5] @group2
  ‚úÖ –£—Å–ø–µ—à–Ω–æ –≤—Å—Ç—É–ø–∏–ª–∏ –≤ –≥—Ä—É–ø–ø—É
  ‚è∏ –ü–∞—É–∑–∞ 8 –º–∏–Ω—É—Ç –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ–º...
```

**üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ, –µ—Å–ª–∏:**
- –ü–æ—Å–ª–µ 1-–π –≥—Ä—É–ø–ø—ã —Ü–∏–∫–ª –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è (–Ω–µ—Ç [2/5])
- –û—à–∏–±–∫–∏ `DetachedInstanceError` –∏–ª–∏ `Parent instance <Group...> is not bound to a Session`
- FloodWait –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤–µ—Å—å —Ü–∏–∫–ª (–¥–æ–ª–∂–µ–Ω –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –≥—Ä—É–ø–ø—É –∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å)

**‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏:**
- FloodWait –Ω–∞ –∫–∞–∂–¥–æ–π 2-–π –≥—Ä—É–ø–ø–µ ‚Üí —Å–Ω–∏–∑–∏—Ç—å –ª–∏–º–∏—Ç –¥–æ 2 –≥—Ä—É–ø–ø –∑–∞ —Å–ª–æ—Ç
- –ê–∫–∫–∞—É–Ω—Ç—ã –Ω–∞—á–∏–Ω–∞—é—Ç –ø–æ–ª—É—á–∞—Ç—å —á–∞—Å—Ç—ã–µ FloodWait ‚Üí "–ø—Ä–æ–≥—Ä–µ–≤" –Ω–µ–æ–±—Ö–æ–¥–∏–º

---

## üîç 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è DetachedInstanceError

### –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
docker-compose logs account-manager | grep -i "detached\|traceback\|not bound to a Session" | tail -20
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—É—Å—Ç–æ (–Ω–µ—Ç –æ—à–∏–±–æ–∫)

**–ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏:** –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Account Manager:
```bash
docker-compose restart account-manager
docker-compose logs -f account-manager
```

---

## üßπ 3. –°–∫—Ä–∏–ø—Ç –†–µ–≤–∏–∑–æ—Ä (Group Reviewer)

### –ó–∞–ø—É—Å–∫ –†–µ–≤–∏–∑–æ—Ä–∞:

```bash
cd /home/tovgrishkoff/PIAR/telegram_promotion_system_bali
DATABASE_URL=postgresql://telegram_user_bali:telegram_password_bali@localhost:5438/telegram_promotion_bali \
python3 scripts/group_reviewer.py
```

**–ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å:**
- ‚úÖ **–°–ï–ô–ß–ê–°** (–ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã Marketer)
- ‚úÖ –ö–∞–∂–¥—ã–µ 24 —á–∞—Å–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ cron)

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
üìä –ò–¢–û–ì–ò –†–ï–í–ò–ó–ò–ò:
   –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –≥—Ä—É–ø–ø: 144
   ‚úÖ –†–µ–∞–ª—å–Ω–æ —É—á–∞—Å—Ç–Ω–∏–∫–∏: 120
   ‚úÖ –ú–æ–≥—É—Ç –ø–æ—Å—Ç–∏—Ç—å: 110
   üö´ –ü–æ–º–µ—á–µ–Ω–æ –∫–∞–∫ banned: 5
   ‚ö†Ô∏è  –ü–æ–º–µ—á–µ–Ω–æ –∫–∞–∫ inaccessible: 25
```

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
- –ï—Å–ª–∏ –º–Ω–æ–≥–æ `banned` –∏–ª–∏ `inaccessible` ‚Üí —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –±–∞–∑–∞ –æ—á–∏—â–∞–µ—Ç—Å—è
- –ü–æ—Å–ª–µ –†–µ–≤–∏–∑–æ—Ä–∞ Marketer –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ –≥—Ä—É–ø–ø–∞–º–∏

---

## üìä 4. Activity (Stories)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤:

```bash
docker-compose logs activity | grep -E "(Loaded|clients|‚úÖ|‚ùå)" | tail -10
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ Loaded 4 accounts
‚úÖ Activity Service initialized
```

**üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ, –µ—Å–ª–∏:**
- `Loaded 0 accounts` ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Å—Å–∏–∏ –≤ `sessions/`
- `–ö–ª–∏–µ–Ω—Ç –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω` ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Account Manager/Marketer (–æ–Ω–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç –ø–µ—Ä–≤—ã–º–∏)

**–¢–µ—Å—Ç —Ä–∞–±–æ—Ç—ã:**
```bash
docker-compose logs activity | grep -E "(viewed|reactions|Cycle completed)" | tail -5
```

---

## üö® 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (Anti-Spam)

### –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø—Ä–æ–±–ª–µ–º:

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ FloodWait:**
```bash
docker-compose logs account-manager | grep -i "floodwait" | tail -20
```

**‚ö†Ô∏è –¢—Ä–µ–≤–æ–∂–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã:**
- FloodWait –Ω–∞ **–∫–∞–∂–¥–æ–π 2-–π –≥—Ä—É–ø–ø–µ** ‚Üí —Å–Ω–∏–∑–∏—Ç—å –ª–∏–º–∏—Ç –¥–æ 2
- FloodWait > 600 —Å–µ–∫—É–Ω–¥ (10 –º–∏–Ω—É—Ç) ‚Üí –≥—Ä—É–ø–ø–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
- FloodWait > 3600 —Å–µ–∫—É–Ω–¥ (1 —á–∞—Å) ‚Üí **–ö–†–ò–¢–ò–ß–ù–û** - –∞–∫–∫–∞—É–Ω—Ç —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥—ã—Ö–∞
- –ê–∫–∫–∞—É–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç FloodWait –ø–æ—Å—Ç–æ—è–Ω–Ω–æ ‚Üí –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –µ–≥–æ

**‚úÖ –£–ª—É—á—à–µ–Ω–∏—è –≤ –∫–æ–¥–µ:**
- FloodWait –¥–æ 10 –º–∏–Ω—É—Ç - —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–æ–∂–¥–µ—Ç –∏ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç –≥—Ä—É–ø–ø—É
- FloodWait > 10 –º–∏–Ω—É—Ç - –≥—Ä—É–ø–ø–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É (–±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è)
- –ê–∫–∫–∞—É–Ω—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å –¥—Ä—É–≥–∏–º–∏ –≥—Ä—É–ø–ø–∞–º–∏

**–î–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:**

1. **–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞** (–µ—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ):
   ```python
   # –í services/account-manager/joiner.py
   max_groups_per_slot = 2  # –í–º–µ—Å—Ç–æ 5
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤:**
   ```bash
   docker-compose exec postgres psql -U telegram_user_bali -d telegram_promotion_bali -c \
     "SELECT session_name, status, last_activity FROM accounts WHERE status='active';"
   ```

3. **–í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞:**
   ```bash
   docker-compose exec postgres psql -U telegram_user_bali -d telegram_promotion_bali -c \
     "UPDATE accounts SET status='suspended' WHERE session_name='–ø—Ä–æ–±–ª–µ–º–Ω—ã–π_–∞–∫–∫–∞—É–Ω—Ç';"
   ```

---

## üìà 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã Marketer

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤:

```bash
docker-compose logs marketer | grep -E "(‚úÖ Sent|‚ùå –û—à–∏–±–∫–∞|üö´ Pre-check failed)" | tail -30
```

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- ‚úÖ –ë–æ–ª—å—à–µ —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤, —á–µ–º –æ—à–∏–±–æ–∫
- üö´ `Pre-check failed` ‚Üí —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ (–≥—Ä—É–ø–ø—ã –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ banned)
- ‚ùå `Write forbidden` ‚Üí –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–µ–¥–∫–æ (–±–ª–∞–≥–æ–¥–∞—Ä—è pre-check)

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å—Ç–æ–≤:**
```bash
docker-compose exec postgres psql -U telegram_user_bali -d telegram_promotion_bali -c \
  "SELECT DATE(sent_at) as date, COUNT(*) as total, \
   SUM(CASE WHEN success THEN 1 ELSE 0 END) as successful, \
   SUM(CASE WHEN NOT success THEN 1 ELSE 0 END) as failed \
   FROM posts GROUP BY DATE(sent_at) ORDER BY date DESC LIMIT 7;"
```

---

## üïê –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫

### –ü–µ—Ä–≤—ã–π —Å–ª–æ—Ç (09:00 Jakarta):
- [ ] Account Manager: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è
- [ ] –†–µ–≤–∏–∑–æ—Ä: –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ—Å–ª–∏ –µ—â–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª–∏
- [ ] Marketer: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —á–∞—Å—Ç—ã—Ö –æ—à–∏–±–æ–∫

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Ç–æ–≥–æ–≤ —Å–ª–æ—Ç–∞ (–∫–æ–º–∞–Ω–¥–∞ –¥–ª—è —É—Ç—Ä–∞):
```bash
# –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è, FloodWait –∏ –ø–∞—É–∑—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
docker-compose logs --tail=100 account-manager | grep -E "Joined|FloodWait|Sleeping|‚úÖ|‚ùå|üìã –û–±—Ä–∞–±–æ—Ç–∞–µ–º"
```

### –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Ü–∏–∫–ª–∞ (—á–µ—Ä–µ–∑ 2 —á–∞—Å–∞):
- [ ] Account Manager: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–π (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 3-5)
- [ ] Marketer: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å—Ç–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ FloodWait —á–∞—Å—Ç–æ—Ç—ã

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –†–µ–≤–∏–∑–æ—Ä–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø—É—Å–∫ –†–µ–≤–∏–∑–æ—Ä–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 03:00
# ‚ö†Ô∏è –í–ê–ñ–ù–û: –°–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
bash scripts/setup_cron_reviewer.sh

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—É—é –∑–∞–¥–∞—á—É:
crontab -l | grep group_reviewer

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:
# 0 3 * * * /usr/bin/docker exec -t telegram-bali-account-manager python /app/scripts/group_reviewer.py >> ...

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ —Å–∫—Ä–∏–ø—Ç –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:
docker exec telegram-bali-account-manager test -f /app/scripts/group_reviewer.py && echo "‚úÖ OK" || echo "‚ùå –ù–ï –Ω–∞–π–¥–µ–Ω"
```

### –ß–µ—Ä–µ–∑ 24 —á–∞—Å–∞:
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –†–µ–≤–∏–∑–æ—Ä –ø–æ–≤—Ç–æ—Ä–Ω–æ
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: —Å–∫–æ–ª—å–∫–æ –≥—Ä—É–ø–ø –¥–æ–±–∞–≤–ª–µ–Ω–æ –∑–∞ —Å—É—Ç–∫–∏
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –ø–æ—Å—Ç–∏–Ω–≥–∞

---

## üìû –ö–æ–º–∞–Ω–¥—ã –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

### –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ª–æ–≥–æ–≤:
```bash
cd /home/tovgrishkoff/PIAR/telegram_promotion_system_bali
docker-compose logs -f --tail=50 account-manager marketer activity
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î:
```bash
docker-compose exec postgres psql -U telegram_user_bali -d telegram_promotion_bali -c "
SELECT 
  (SELECT COUNT(*) FROM groups WHERE status='active' AND can_post=true) as active_groups,
  (SELECT COUNT(*) FROM accounts WHERE status='active') as active_accounts,
  (SELECT COUNT(*) FROM posts WHERE DATE(sent_at)=CURRENT_DATE AND success=true) as posts_today_success,
  (SELECT COUNT(*) FROM posts WHERE DATE(sent_at)=CURRENT_DATE AND success=false) as posts_today_failed;
"
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:
```bash
docker-compose restart account-manager marketer activity
```

---

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** –ï—Å–ª–∏ FloodWait —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —á–∞—Å—Ç—ã–º ‚Üí —Å–Ω–∏–∑–∏—Ç—å –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç—å. –õ—É—á—à–µ –º–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ.

---

*–û–±–Ω–æ–≤–ª–µ–Ω–æ: 2026-01-10*
