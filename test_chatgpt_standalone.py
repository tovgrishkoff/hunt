#!/usr/bin/env python3
"""
–ê–≤—Ç–æ–Ω–æ–º–Ω—ã–π —Ç–µ—Å—Ç ChatGPT –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ (–º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º openai)
"""

import asyncio
import os

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è API –∫–ª—é—á–∞
OPENAI_API_KEY = os.getenv('OPENAI_API_KEY', '')

if not OPENAI_API_KEY:
    print("‚ùå OPENAI_API_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω!")
    exit(1)

os.environ['OPENAI_API_KEY'] = OPENAI_API_KEY

async def test_direct_api():
    """–ü—Ä—è–º–æ–π —Ç–µ—Å—Ç API"""
    try:
        from openai import AsyncOpenAI
        
        client = AsyncOpenAI(api_key=OPENAI_API_KEY)
        
        print("=" * 80)
        print("üß™ –¢–ï–°–¢ ChatGPT –ì–ï–ù–ï–†–ê–¢–û–†–ê –û–¢–í–ï–¢–û–í")
        print("=" * 80)
        print()
        
        test_message = "–ü—Ä–∏–≤–µ—Ç! –Ø —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ, –º–æ–≥—É —Å–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ—Å–µ—Å—Å–∏—é –Ω–∞ –ë–∞–ª–∏. –¶–µ–Ω—ã –æ—Ç 100$"
        
        # –ü—Ä–æ–º–ø—Ç —Å –ø—Ä–∏–∑—ã–≤–æ–º –∫ –¥–µ–π—Å—Ç–≤–∏—é (–∫–∞–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ)
        prompt = f"""–¢—ã - –æ–ø—ã—Ç–Ω—ã–π –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–æ–¥–∞–≤–∞—Ç—å Telegram-–±–æ—Ç–∞ @Lead_Hunbot —á–µ—Ä–µ–∑ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è.

–ö–æ–Ω—Ç–µ–∫—Å—Ç:
- –¢—ã –æ—Ç–≤–µ—á–∞–µ—à—å –Ω–∞ –ª–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —á–µ–ª–æ–≤–µ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–ª–æ–∂–∏–ª —Å–≤–æ—é —É—Å–ª—É–≥—É
- –¢—ã –ù–ï –ø–æ–∫—É–ø–∞–µ—à—å —É—Å–ª—É–≥—É, –∞ –º—è–≥–∫–æ –ø—Ä–æ–¥–∞–µ—à—å –±–æ—Ç–∞ @Lead_Hunbot
- –ë–æ—Ç –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞/—É—Å–ª—É–≥
- –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º, –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –∏ –Ω–µ–Ω–∞–≤—è–∑—á–∏–≤—ã–º
- –î–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞: 2-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (–º–∞–∫—Å–∏–º—É–º 200 —Å–∏–º–≤–æ–ª–æ–≤)
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–ø–æ–º—è–Ω–∏ @Lead_Hunbot –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –æ–±—Ä–∞–∑–æ–º

–¢–∏–ø —É—Å–ª—É–≥–∏ –∫–ª–∏–µ–Ω—Ç–∞: —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ/–≤–∏–¥–µ–æ–≥—Ä–∞—Ñ (—Ñ–æ—Ç–æ—Å–µ—Å—Å–∏–∏, —Å—ä–µ–º–∫–∏, –º–æ–Ω—Ç–∞–∂)

–í—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞:
"{test_message}"

–¢–≤–æ—è –∑–∞–¥–∞—á–∞:
1. –ü–æ–±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç—å –∑–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ –≤—ã—Ä–∞–∑–∏—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å
2. –ú—è–≥–∫–æ —Å–ø—Ä–æ—Å–∏—Ç—å, –∫–∞–∫ –æ–Ω–∏ –Ω–∞—Ö–æ–¥—è—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ (–∏–ª–∏ —É–ø–æ–º—è–Ω—É—Ç—å —ç—Ç—É —Ç–µ–º—É)
3. –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –æ–±—Ä–∞–∑–æ–º —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ @Lead_Hunbot –∏ –µ–≥–æ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞—Ö –¥–ª—è –∏—Ö —Ç–∏–ø–∞ —É—Å–ª—É–≥
4. –ü—Ä–∏–≤–µ—Å—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–Ω–æ –Ω–µ –≤—ã–¥—É–º—ã–≤–∞–π, –∏—Å–ø–æ–ª—å–∑—É–π –æ–±—â–∏–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ —Ç–∏–ø–∞ "–ø–æ–º–æ–≥ –Ω–∞–π—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤")
5. –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å
6. –í –∫–æ–Ω—Ü–µ –æ—Ç–≤–µ—Ç–∞ –î–û–ë–ê–í–¨ –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é (–≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç, –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –≤–ø–∏—à–∏ –≤ —Ç–µ–∫—Å—Ç):
   - –ü–µ—Ä–µ—Ö–æ–¥–∏ –≤ @Lead_Hunbot –∏ –ø–æ–ø—Ä–æ–±—É–π - –Ω–µ –ø–æ–∂–∞–ª–µ–µ—à—å!
   - –ó–∞—Ö–æ–¥–∏ –≤ @Lead_Hunbot, —Ç–∞–º —Ä–µ–∞–ª—å–Ω–æ –Ω–∞—Ö–æ–¥—è—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç!
   - –ü—Ä–æ–≤–µ—Ä—å @Lead_Hunbot, –º–æ–∂–µ—Ç –∏ —Ç–µ–±–µ –ø–æ–¥–æ–π–¥–µ—Ç
   - –ü–æ–ø—Ä–æ–±—É–π @Lead_Hunbot - —Ç–∞–º –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –º–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤
   - –ó–∞–≥–ª—è–Ω–∏ –≤ @Lead_Hunbot, –æ—á–µ–Ω—å —Ä–µ–∫–æ–º–µ–Ω–¥—É—é!

–í–ê–ñ–ù–û: –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º —Ç–µ–∫—Å—Ç–∞, –Ω–µ –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º.

–í–∞–∂–Ω–æ:
- –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –ë—É–¥—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –∏ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º, –∫–∞–∫ –≤ –ª–∏—á–Ω–æ–π –ø–µ—Ä–µ–ø–∏—Å–∫–µ
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π —à–∞–±–ª–æ–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã, —Å–¥–µ–ª–∞–π –æ—Ç–≤–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–º
- –ò—Å–ø–æ–ª—å–∑—É–π —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π —Å—Ç–∏–ª—å
- –ù–µ –ø–µ—Ä–µ–±–æ—Ä—â–∏ —Å –ø—Ä–æ–¥–∞–∂–∞–º–∏ - –±—É–¥—å –Ω–µ–Ω–∞–≤—è–∑—á–∏–≤—ã–º
- –ï—Å–ª–∏ –¥–æ–±–∞–≤–ª—è–µ—à—å –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é, —Å–¥–µ–ª–∞–π –µ–≥–æ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º —Ç–µ–∫—Å—Ç–∞

–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –æ—Ç–≤–µ—Ç:"""
        
        print(f"üì• –í—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: {test_message}")
        print()
        print("üîÑ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ ChatGPT API...")
        print()
        
        response = await client.chat.completions.create(
            model="gpt-4o-mini",
            messages=[
                {
                    "role": "system",
                    "content": "–¢—ã –æ–ø—ã—Ç–Ω—ã–π –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–æ–¥–∞–≤–∞—Ç—å Telegram-–±–æ—Ç–∞ —á–µ—Ä–µ–∑ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è. –¢—ã –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π, –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∏ –Ω–µ–Ω–∞–≤—è–∑—á–∏–≤—ã–π –≤ –ø—Ä–æ–¥–∞–∂–∞—Ö."
                },
                {
                    "role": "user",
                    "content": prompt
                }
            ],
            temperature=0.8,
            max_tokens=200,
            timeout=10.0
        )
        
        content = response.choices[0].message.content.strip()
        
        print("=" * 80)
        print("‚úÖ –û–¢–í–ï–¢ –°–ì–ï–ù–ï–†–ò–†–û–í–ê–ù:")
        print("=" * 80)
        print()
        print(content)
        print()
        print("=" * 80)
        print()
        print(f"üìè –î–ª–∏–Ω–∞: {len(content)} —Å–∏–º–≤–æ–ª–æ–≤")
        print()
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∏
        checks = []
        if "@Lead_Hunbot" in content or "Lead_Hunbot" in content:
            checks.append("‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –±–æ—Ç–∞")
        else:
            checks.append("‚ùå –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –±–æ—Ç–∞")
        
        action_words = ["–ø–µ—Ä–µ—Ö–æ–¥–∏", "–∑–∞—Ö–æ–¥–∏", "–ø—Ä–æ–≤–µ—Ä—å", "–ø–æ–ø—Ä–æ–±—É–π", "–∑–∞–≥–ª—è–Ω–∏", "–æ—Ç–∫—Ä–æ–π", "–ø–æ—Å–º–æ—Ç—Ä–∏"]
        has_action = any(word in content.lower() for word in action_words)
        if has_action:
            checks.append("‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é")
        else:
            checks.append("‚ÑπÔ∏è –ë–µ–∑ –ø—Ä—è–º–æ–≥–æ –ø—Ä–∏–∑—ã–≤–∞ (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è 30% –æ—Ç–≤–µ—Ç–æ–≤)")
        
        for check in checks:
            print(check)
        
        print()
        print("=" * 80)
        
        return True
        
    except ImportError:
        print("‚ùå –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ openai –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞")
        print("üí° –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install openai")
        return False
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        import traceback
        traceback.print_exc()
        return False

if __name__ == "__main__":
    asyncio.run(test_direct_api())

