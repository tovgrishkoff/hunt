# üì± –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ Stories –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –¥–ª—è –∞–∫–∫–∞—É–Ω—Ç–∞ @grishkoff

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –î–æ–±–∞–≤–ª–µ–Ω –∞–∫–∫–∞—É–Ω—Ç –≤ –ë–î

–ê–∫–∫–∞—É–Ω—Ç `promotion_new_account` (@grishkoff) –¥–æ–±–∞–≤–ª–µ–Ω –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:
- **ID:** 5
- **Session name:** `promotion_new_account`
- **Status:** `active`
- **Phone:** +380930734685
- **Nickname:** Grisha

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í `config/niches/bali.json` –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```json
"activity": {
  ...
  "contacts_view_accounts": ["promotion_new_account"],
  "contacts_dialogs_limit": 300
}
```

### 3. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω –∫–æ–¥ Activity Service

#### –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_contacts_from_dialogs()`
- –ü–æ–ª—É—á–∞–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏–∑ –¥–∏–∞–ª–æ–≥–æ–≤ —á–µ—Ä–µ–∑ `client.get_dialogs()`
- –§–∏–ª—å—Ç—Ä—É–µ—Ç –±–æ—Ç–æ–≤
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `process_account()`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∞–∫–∫–∞—É–Ω—Ç –∞–∫–∫–∞—É–Ω—Ç–æ–º –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
- –ï—Å–ª–∏ `account.session_name` –≤ —Å–ø–∏—Å–∫–µ `contacts_view_accounts`:
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `get_contacts_from_dialogs()` –≤–º–µ—Å—Ç–æ –≥—Ä—É–ø–ø
  - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç Stories –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (–¥–æ 50 –∑–∞ —Ü–∏–∫–ª)
- –ò–Ω–∞—á–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–±—ã—á–Ω–æ (–ø—Ä–æ—Å–º–æ—Ç—Ä Stories —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥—Ä—É–ø–ø)

#### –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `view_user_stories()`
- –ü–∞—Ä–∞–º–µ—Ç—Ä `group` —Ç–µ–ø–µ—Ä—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π (`Optional[Group] = None`)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–µ–∑ –≥—Ä—É–ø–ø—ã

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –î–ª—è –∞–∫–∫–∞—É–Ω—Ç–∞ `promotion_new_account` (@grishkoff):

```
Activity Service –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
    ‚Üì
–î–ª—è promotion_new_account:
    ‚Üì
–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (contacts_view_accounts)
    ‚Üì
–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∏–∑ –¥–∏–∞–ª–æ–≥–æ–≤ (get_dialogs, limit=300)
    ‚Üì
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞ (–¥–æ 50):
    ‚Üì
–ü–æ–ª—É—á–µ–Ω–∏–µ Stories –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    ‚Üì
–ü—Ä–æ—Å–º–æ—Ç—Ä Story (70% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å)
    ‚Üì
–†–µ–∞–∫—Ü–∏—è (30% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å)
    ‚Üì
–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –¥–µ–π—Å—Ç–≤–∏—è–º–∏
```

### –î–ª—è –¥—Ä—É–≥–∏—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–µ–∂–∏–º):

```
Activity Service –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
    ‚Üì
–î–ª—è –∞–∫–∫–∞—É–Ω—Ç–∞:
    ‚Üì
–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ Stories —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥—Ä—É–ø–ø
    ‚Üì
–ü–æ–ª—É—á–µ–Ω–∏–µ –≥—Ä—É–ø–ø, –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã—Ö –∑–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–º
    ‚Üì
–î–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã:
    ‚Üì
–ü–æ–ª—É—á–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥—Ä—É–ø–ø—ã
    ‚Üì
–ü—Ä–æ—Å–º–æ—Ç—Ä Stories —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
```

## üìä –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –í –∫–æ–Ω—Ñ–∏–≥–µ `config/niches/bali.json`:

- `contacts_view_accounts`: —Å–ø–∏—Å–æ–∫ session_name –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
- `contacts_dialogs_limit`: –º–∞–∫—Å–∏–º—É–º –¥–∏–∞–ª–æ–≥–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 300)

### –õ–∏–º–∏—Ç—ã:

- –ú–∞–∫—Å–∏–º—É–º –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∑–∞ —Ü–∏–∫–ª: **50**
- –õ–∏–º–∏—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –≤ –¥–µ–Ω—å: **200** (–∫–∞–∫ –¥–ª—è –≤—Å–µ—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤)
- –ó–∞–¥–µ—Ä–∂–∫–∏: —Ç–∞–∫–∏–µ –∂–µ, –∫–∞–∫ –¥–ª—è –≥—Ä—É–ø–ø

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –õ–æ–≥–∏ Activity Service:

```
üì± –ê–∫–∫–∞—É–Ω—Ç promotion_new_account: —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ Stories –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
üìã –ê–∫–∫–∞—É–Ω—Ç promotion_new_account: –Ω–∞–π–¥–µ–Ω–æ N –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
üëÅÔ∏è promotion_new_account –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–ª Story @username (–∫–æ–Ω—Ç–∞–∫—Ç)
‚úÖ –ê–∫–∫–∞—É–Ω—Ç promotion_new_account: –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ N –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ –ë–î:

```sql
SELECT a.session_name, COUNT(*) as views 
FROM story_views sv 
JOIN accounts a ON sv.account_id = a.id 
WHERE a.session_name = 'promotion_new_account'
GROUP BY a.session_name;
```

## ‚öôÔ∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥—Ä—É–≥–∏—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤

–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –µ—â–µ –∞–∫–∫–∞—É–Ω—Ç—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤:

1. –î–æ–±–∞–≤—å—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –≤ –ë–î
2. –î–æ–±–∞–≤—å—Ç–µ `session_name` –≤ `contacts_view_accounts` –≤ `config/niches/bali.json`:

```json
"contacts_view_accounts": ["promotion_new_account", "another_account"]
```

3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Activity Service: `docker-compose restart activity`

---

*–û–±–Ω–æ–≤–ª–µ–Ω–æ: 2026-01-11*
